/*
 * jQuery tableSelect plugin 1.2.0
 *
 * Copyright (c) 2010 Kjel Delaey
 *
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
*/

(function(a){a.extend(a.fn,{tableSelect:function(b){tableSelector=new a.tableSelector(b,this);return tableSelector}});a.extend(a.fn,{tableSelectOne:function(b){var b=a.extend({multiSelect:false},b);tableSelector=new a.tableSelector(b,this);return tableSelector}});a.extend(a.fn,{tableSelectMany:function(b){var b=a.extend({multiSelect:true},b);tableSelector=new a.tableSelector(b,this);return tableSelector}});a.tableSelector=function(b,c){this.options=a.extend({},a.tableSelector.defaults,b);this.currentTable=c;this.init()};a.extend(a.tableSelector,{defaults:{tableClass:"tableselect",rowSelectClass:"selected",multiSelect:false},prototype:{init:function(){this.selections=[];this.listeners=this.options.listeners||{};this.collectRows();this.initRowEvents();a(this.currentTable).addClass(this.options.tableClass)},allSelected:function(){return(this.selections.length==this.rows.length)},getSelections:function(){return this.selections},getFocusedRow:function(){return this.rows[this.lastActiveRow]},isSelected:function(d){var b=false;for(var c=0;c<this.selections.length;c++){if(this.selections[c]==d){b=true;break}}return b},collectRows:function(){var b=this;this.rows=this.currentTable[0].tBodies[0].rows;a(this.rows).each(function(){this.parentThis=b})},initRowEvents:function(){var b=this;a(this.rows).each(function(){a(this).bind("click",b.handleMouseDown);a(this).bind("rowselect",b.rowSelectClass);a(this).bind("rowdeselect",b.rowSelectClass);b.initListeners(b,this)})},initListeners:function(c,d){if(c.listeners){var b=c.listeners;if(b.beforerowselect){a(d).bind("beforerowselect",b.beforerowselect)}if(b.afterrowselect){a(d).bind("afterrowselect",b.afterrowselect)}if(b.beforerowdeselect){a(d).bind("beforerowdeselect",b.beforerowdeselect)}if(b.afterrowdeselect){a(d).bind("afterrowdeselect",b.afterrowdeselect)}}},handleMouseDown:function(c){var b=this.parentThis;b.storeEventTarget(c,this);if(b.options.multiSelect){b.handleKeyDown(c,this)}else{b.handleSingleSelect(this)}b.resetEventTarget(this)},handleKeyDown:function(b,c){var d=c.sectionRowIndex;if(b.shiftKey){if(typeof(this.lastActiveRow)=="undefined"){this.focusRow(d)}this.lockedRow=this.lastActiveRow;if(b.ctrlKey){this.selectRange(this.lastActiveRow,d,true)}else{this.selectRange(this.lockedRow,d,false);this.focusRow(this.lockedRow)}}else{this.handleSingleSelect(c)}},storeEventTarget:function(b,d){var c=b.target&&b.target.nodeName;d.target=c?c.toLowerCase():null},resetEventTarget:function(b){b.target=undefined},handleSingleSelect:function(b){var c=b.sectionRowIndex;if(this.isSelected(b)){this.deselectRow(c)}else{this.selectRow(c,this.options.multiSelect)}},selectRow:function(d,c){var b=this.rows[d];if(c==false){this.clearSelections()}if(b&&this.isSelected(b)==false&&a(b).trigger("beforerowselect")!==false){if(b.preventChange!==true){this.selections.push(b);this.focusRow(d);a(b).trigger("rowselect");a(b).trigger("afterrowselect");a(document).trigger("rowchange",this)}b.preventChange=undefined}},deselectRow:function(d){var c=this.rows[d];if(c&&this.isSelected(c)&&a(c).trigger("beforerowdeselect")!==false){if(c.preventChange!==true){var b=a.inArray(c,this.selections);if(-1!=b){this.selections.splice(b,1);this.focusRow(d);a(c).trigger("rowdeselect");a(c).trigger("afterrowdeselect");a(document).trigger("rowchange",this)}}c.preventChange=undefined}},focusRow:function(b){this.lastActiveRow=b},rowSelectClass:function(b){switch(b.type){case"rowselect":a(this).addClass(this.parentThis.options.rowSelectClass);break;case"rowdeselect":a(this).removeClass(this.parentThis.options.rowSelectClass);break;default:break}},selectAll:function(){if(this.options.multiSelect){this.clearSelections();a(this.rows).each(function(){this.parentThis.selectRow(this.sectionRowIndex,true)})}},clearSelections:function(){a(this.rows).each(function(){this.parentThis.deselectRow(this.sectionRowIndex)})},selectRange:function(d,c,e){if(e==false){this.clearSelections()}if(d<=c){for(var b=d;b<=c;b++){this.selectRow(b,true)}}else{for(var b=d;b>=c;b--){this.selectRow(b,true)}}}}})})(jQuery);
